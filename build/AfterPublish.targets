<Project>
  <PropertyGroup>
    <__DirectoryName Condition="'$(Engine)' == 'WindowsDX'">Windows</__DirectoryName>
    <__DirectoryName Condition="'$(Engine)' == 'WindowsGL' Or '$(Engine)' == 'UniversalGL'">OpenGL</__DirectoryName>
    <__DirectoryName Condition="'$(Engine)' == 'WindowsXNA'">XNA</__DirectoryName>
  </PropertyGroup>
  
  <PropertyGroup>
    <__RunAppHostPatcher>False</__RunAppHostPatcher>
    <__RunAppHostPatcher Condition="$(TargetFramework.Contains('-'))">True</__RunAppHostPatcher> <!-- .NET6 WinForms Windows specific -->
    <__RunAppHostPatcher Condition="'$(TargetFrameworkIdentifier)' != '.NETFramework' And '$(Engine)' == 'UniversalGL' And'$(RuntimeIdentifier)' != ''">True</__RunAppHostPatcher> <!-- .NET6 UniversalGL platform specific -->
  </PropertyGroup>

  <Target Name="PatchAppHost" AfterTargets="Publish" Condition="$(__RunAppHostPatcher)">
    <PropertyGroup>
      <__AssemblyFileName Condition="Exists('$(PublishDir)$(AssemblyName).dll')">$(PublishDir)$(AssemblyName).dll</__AssemblyFileName>
      <__AssemblyFileName Condition="Exists('$(PublishDir)$(AssemblyName)')">$(PublishDir)$(AssemblyName)</__AssemblyFileName>
      <__AssemblyFileName Condition="Exists('$(PublishDir)$(AssemblyName).exe')">$(PublishDir)$(AssemblyName).exe</__AssemblyFileName>
    </PropertyGroup>
    <Message Importance="high" Text="AppHostPatcher $(__AssemblyFileName)"></Message>
    <Exec ConsoleToMsBuild="True" Command="dotnet &quot;$(MSBuildThisFileDirectory)../AdditionalFiles/AppHostPatcher/AppHostPatcher.dll&quot; &quot;$(__AssemblyFileName)&quot; &quot;$(AssemblyName).dll&quot; &quot;Binaries/$(__DirectoryName)/$(AssemblyName).dll&quot;" />
  </Target>

  <Target Name="RemoveSDL" AfterTargets="Publish" Condition="'$(TargetFrameworkIdentifier)' == '.NETFramework'">
    <Delete Condition="'$(Engine)' == 'UniversalGL' Or '$(Engine)' == 'WindowsGL'" Files="$(PublishDir)SDL2.dll" />
    <Delete Condition="'$(Engine)' == 'UniversalGL' Or '$(Engine)' == 'WindowsGL'" Files="$(PublishDir)soft_oal.dll" />
  </Target>
  
  <Target Name="RemoveCrossPlatformExecutable" AfterTargets="Publish" Condition="'$(TargetFrameworkIdentifier)' != '.NETFramework' And '$(Engine)' == 'UniversalGL' And '$(RuntimeIdentifier)' == ''"> <!-- .NET6 UniversalGL cross platform -->
    <Delete Files="$(PublishDir)$(AssemblyName).exe" />
  </Target>
</Project>